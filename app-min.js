const express=require("express"),hbs=require("express-handlebars"),bodyParser=require("body-parser"),mongoose=require("mongoose"),app=express(),request=require("request");var nodemailer=require("nodemailer"),multer=require("multer"),upload=multer({dest:"/tmp/"});app.use(express.static("assets")),app.use(bodyParser.urlencoded({extended:!0})),app.engine("hbs",hbs({extname:"hbs",defaultLayout:"layouts",layoutsDir:__dirname+"/views/layouts/"})),app.set("view engine","hbs"),mongoose.connect("mongodb://localhost:27017/pacific_printing");const pacificshopSchema=new mongoose.Schema({name:String,image1:String,image2:String,image3:String,price_small:Number,price_big:Number,size:String,desc:String,imagemock:String}),PacificShop=mongoose.model("PacificShop",pacificshopSchema);var productMetaSchema=new mongoose.Schema({garment:String,color:String,size:String,image1:String,image2:String,image3:String,images:String,price_small:Number,price_big:Number,productID:{type:mongoose.Schema.Types.ObjectId,ref:"PacificShop"}});const ProductMeta=mongoose.model("ProductMeta",productMetaSchema);function sendMails(e,i){var o="<p>name-</p>"+e.name+"<p>email-</p>"+e.email+"<p>phone-</p>"+e.phone+"<p>bussinessName-</p>"+e.bussinessName+"<p>QUANTITY-</p>"+e.qty+"<p>type-</p>"+e.type+"<p>service-</p>"+e.service,n=nodemailer.createTransport({service:"gmail",auth:{user:"aanandchamp@gmail.com",pass:"omsairam@#jio"}}),t={from:e.email,to:"aanandchamp@gmail.com",subject:"Contact Info",html:o,attachments:[{filename:i.originalname,path:i.path}]};n.sendMail(t,function(e,i){e?console.log(e):console.log("Email sent: "+i.response)})}PacificShop.create({name:"907",imagemock:"/img/shop/matt_h_collection/matt_h_907/matt_h_907_mock.png",image1:"/img/skiff_1_shop.jpg",image2:"/img/skiff_2_shop.jpg",image3:"/img/shop/matt_h_collection/matt_h_907/matt_h_907_mock.png",desc:"test",size:["SM","M","L","XL","2XL","3XL","4XL"],price_small:17.99,price_big:19.99},function(e,i){e?console.log(e):(console.log("CREATED SHOP ITEM: "),console.log(i),ProductMeta.create({garment:"Uni - Sex Tee Shirts",color:["Black","Gray","Navy","Royal","Dk Green"],images:["/img/shop/matt_h_collection/matt_h_907/uni_tshirt/matt_h_907_uni_black.png","/img/shop/matt_h_collection/matt_h_907/uni_tshirt/matt_h_907_uni_ash.png","/img/shop/matt_h_collection/matt_h_907/uni_tshirt/matt_h_907_uni_navy.png","/img/shop/matt_h_collection/matt_h_907/uni_tshirt/matt_h_907_uni_royal.png","/img/shop/matt_h_collection/matt_h_907/uni_tshirt/matt_h_907_dk_green.png"],image1:"/img/shop/matt_h_collection/matt_h_907/uni_tshirt/matt_h_907_uni_black.png",image2:"/img/download3.jpg",image3:"/img/downloa4.jpg",size:["SM","M","L","XL","2XL","3XL","4XL"],price_small:17.99,price_big:19.99,productID:i._id},function(e,i){e?console.log(e):(console.log("CREATED SHOP ITEM: "),console.log(i))}),ProductMeta.create({garment:"Premium Mens Tee Shirt",color:["Vintage Black","Gray","Navy","Ocean","Blue","Heather","Green"],image:"/img/download2.jpg",images:["/img/black.jpg","/img/gray.jpg","/img/navy.jpg"],image1:"/img/download.jpg",image2:"/img/download3.jpg",image3:"/img/downloa4.jpg",price_small:19.99,price_big:21.99,size:["SM","M","L","XL","2XL","3XL","4XL"],productID:i._id},function(e,i){e?console.log(e):(console.log("CREATED SHOP ITEM: "),console.log(i))}))}),app.get("/shop",function(e,i){PacificShop.find({},function(e,o){e?console.long(e):i.render("matt-hamiliton-collection",{pacificshop:o})})}),app.get("/shop/:id",function(e,i){PacificShop.findById(e.params.id,function(e,o){e?console.log(e):i.render("shop-item",{pacificshop:o})})}),app.get("/",function(e,i){i.render("index")}),app.get("/services",function(e,i){i.render("services")}),app.get("/print-requirements",function(e,i){i.render("print-requirements")}),app.get("/contact",function(e,i){i.render("contact")}),app.post("/contact",upload.single("file"),function(e,i){console.log(e.body),sendMails(e.body,e.file)}),app.get("/garment",function(e,i){ProductMeta.find({productID:e.query._id},function(e,o){e?console.log(e):i.send(o)})}),app.get("/garmentSingle",function(e,i){ProductMeta.find({_id:e.query._id},function(e,o){e?console.log(e):i.send(o)})}),app.get("/colors",function(e,i){ProductMeta.find({_id:e.query._id},function(e,o){e?console.log(e):i.send(o)})}),app.get("/size",function(e,i){ProductMeta.find({_id:e.query._id},function(e,o){e?console.log(e):i.send(o)})}),app.listen(process.env.PORT||8002,function(){console.log("Pacific Printing Server Is Running")});