const express=require("express"),hbs=require("express-handlebars"),bodyParser=require("body-parser"),mongoose=require("mongoose"),app=express(),request=require("request");var nodemailer=require("nodemailer"),multer=require("multer"),upload=multer({dest:"/tmp/"});app.use(express.static("assets")),app.use(bodyParser.urlencoded({extended:!0})),app.engine("hbs",hbs({extname:"hbs",defaultLayout:"layouts",layoutsDir:__dirname+"/views/layouts/"})),app.set("view engine","hbs"),mongoose.connect("mongodb://ncdesignco:NCAK20!9@ds031223.mlab.com:31223/heroku_1gbtwtrj");const pacificshopSchema=new mongoose.Schema({name:String,image1:String,image2:String,image3:String,class:String,price_small:Number,price_big:Number,size:String,desc:String,imagemock:String}),PacificShop=mongoose.model("PacificShop",pacificshopSchema);var productMetaSchema=new mongoose.Schema({garment:String,color:String,size:String,image1:String,image2:String,image3:String,images:String,price_small:Number,price_big:Number,productID:{type:mongoose.Schema.Types.ObjectId,ref:"PacificShop"}});const ProductMeta=mongoose.model("ProductMeta",productMetaSchema);function sendMails(e,n,i){var o=n.originalname.split(".").pop();if(console.log(o),"png"!==o&&"jpg"!==o&&"pdf"!==o&&"jpeg"!==o)return i.send("Only images and pdf are allowed"),!1;var a="<p>name-</p>"+e.name+"<p>email-</p>"+e.email+"<p>phone-</p>"+e.phone+"<p>bussinessName-</p>"+e.bussinessName+"<p>QUANTITY-</p>"+e.qty+"<p>type-</p>"+e.type+"<p>service-</p>"+e.service,t=nodemailer.createTransport({service:"gmail",auth:{user:"jeremy.daniel1981@gmail.com",pass:"ncak2018"}}),s={from:e.email,to:"jeremy.daniel1981@gmail.com",subject:"Contact Info",html:a,attachments:[{filename:n.originalname,path:n.path}]};t.sendMail(s,function(e,n){e?console.log(e):i.redirect("/")})}function sendMailsContent(e,n){var i="<p>name-</p>"+e.name+"<p>email-</p>"+e.email+"<p>phone-</p>"+e.phone+"<p>bussinessName-</p>"+e.bussinessName+"<p>QUANTITY-</p>"+e.qty+"<p>type-</p>"+e.type+"<p>service-</p>"+e.service,o=nodemailer.createTransport({service:"gmail",auth:{user:"jeremy.daniel1981@gmail.com",pass:"ncak2018"}}),a={from:e.email,to:"jeremy.daniel1981@gmail.com",subject:"Contact Info",html:i};o.sendMail(a,function(e,i){e?console.log(e):n.send("Successfully submitted ")})}app.get("/",function(e,n){n.render("index",{navstrip:"phone-nav",stripimage:"/img/phone_number.png"})}),app.get("/services",function(e,n){n.render("services",{navstrip:"shop-nav",stripimage:"/img/shop_phone.png"})}),app.get("/print-requirements",function(e,n){n.render("print-requirements",{navstrip:"phone-nav",stripimage:"/img/phone_number.png"})}),app.get("/shop",function(e,n){PacificShop.find({},function(e,i){e?console.long(e):n.render("matt-hamiliton-collection",{pacificshop:i,navstrip:"phone-nav",stripimage:"/img/phone_number.png"})})}),app.get("/shop/:id",function(e,n){PacificShop.findById(e.params.id,function(e,i){e?console.log(e):n.render("shop-item",{pacificshop:i,navstrip:"shop-nav",stripimage:"/img/shop_phone.png"})})}),app.get("/contact",function(e,n){n.render("contact",{navstrip:"phone-nav",stripimage:"/img/phone_number.png"})}),app.post("/contact",upload.single("file"),function(e,n){null!=e.file?sendMails(e.body,e.file,n):sendMailsContent(e.body,n)}),app.get("/garment",function(e,n){ProductMeta.find({productID:e.query._id},function(e,i){e?console.log(e):n.send(i)})}),app.get("/garmentSingle",function(e,n){ProductMeta.find({_id:e.query._id},function(e,i){e?console.log(e):n.send(i)})}),app.get("/colors",function(e,n){ProductMeta.find({_id:e.query._id},function(e,i){e?console.log(e):n.send(i)})}),app.get("/size",function(e,n){ProductMeta.find({_id:e.query._id},function(e,i){e?console.log(e):n.send(i)})}),app.listen(process.env.PORT||8002,function(){console.log("Pacific Printing Server Is Running")});