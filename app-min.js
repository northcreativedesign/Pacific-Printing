const express=require("express"),hbs=require("express-handlebars"),bodyParser=require("body-parser"),mongoose=require("mongoose"),app=express(),request=require("request");var nodemailer=require("nodemailer"),multer=require("multer"),upload=multer({dest:"/tmp/"});app.use(express.static("assets")),app.use(bodyParser.urlencoded({extended:!0})),app.engine("hbs",hbs({extname:"hbs",defaultLayout:"layouts",layoutsDir:__dirname+"/views/layouts/"})),app.set("view engine","hbs"),mongoose.connect("mongodb://localhost:27017/pacific_printing");const pacificshopSchema=new mongoose.Schema({name:String,image1:String,image2:String,image3:String,price_small:Number,price_big:Number,size:String,desc:String,imagemock:String}),PacificShop=mongoose.model("PacificShop",pacificshopSchema);var productMetaSchema=new mongoose.Schema({garment:String,color:String,size:String,image1:String,image2:String,image3:String,images:String,price_small:Number,price_big:Number,productID:{type:mongoose.Schema.Types.ObjectId,ref:"PacificShop"}});const ProductMeta=mongoose.model("ProductMeta",productMetaSchema);function sendMails(e,n){var o="<p>name-</p>"+e.name+"<p>email-</p>"+e.email+"<p>phone-</p>"+e.phone+"<p>bussinessName-</p>"+e.bussinessName+"<p>QUANTITY-</p>"+e.qty+"<p>type-</p>"+e.type+"<p>service-</p>"+e.service,i=nodemailer.createTransport({service:"gmail",auth:{user:"aanandchamp@gmail.com",pass:"omsairam@#jio"}}),t={from:e.email,to:"aanandchamp@gmail.com",subject:"Contact Info",html:o,attachments:[{filename:n.originalname,path:n.path}]};i.sendMail(t,function(e,n){e?console.log(e):console.log("Email sent: "+n.response)})}app.get("/shop",function(e,n){PacificShop.find({},function(e,o){e?console.long(e):n.render("matt-hamiliton-collection",{pacificshop:o})})}),app.get("/shop/:id",function(e,n){PacificShop.findById(e.params.id,function(e,o){e?console.log(e):n.render("shop-item",{pacificshop:o})})}),app.get("/",function(e,n){n.render("index")}),app.get("/services",function(e,n){n.render("services")}),app.get("/print-requirements",function(e,n){n.render("print-requirements")}),app.get("/contact",function(e,n){n.render("contact")}),app.post("/contact",upload.single("file"),function(e,n){console.log(e.body),sendMails(e.body,e.file)}),app.get("/garment",function(e,n){ProductMeta.find({productID:e.query._id},function(e,o){e?console.log(e):n.send(o)})}),app.get("/garmentSingle",function(e,n){ProductMeta.find({_id:e.query._id},function(e,o){e?console.log(e):n.send(o)})}),app.get("/colors",function(e,n){ProductMeta.find({_id:e.query._id},function(e,o){e?console.log(e):n.send(o)})}),app.get("/size",function(e,n){ProductMeta.find({_id:e.query._id},function(e,o){e?console.log(e):n.send(o)})}),app.listen(process.env.PORT||8002,function(){console.log("Pacific Printing Server Is Running")});